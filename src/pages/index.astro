---
import BaseLayout from "@/layouts/base-layout.astro";
import Projects from "@/components/projects.astro";
import { getCollection } from "astro:content";

import Posts from "@/components/posts.astro";
import SeriesList from "@/components/series.astro";
import Intro from "@/components/intro.astro";

const posts = await getCollection("blog");

const sortedPosts = posts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .filter((post) => !post.data.planned && post.data.published)
  .slice(0, 2);

const pinnedPosts = posts.filter(
  (post) => post.data.pinned && post.data.published
);

const pinnedSeries = (await getCollection("series")).filter(
  (s) => s.data.pinned && s.data.published
);

const projects = await getCollection("project");
const sortedProjects = projects.sort((a, b) => a.data.index - b.data.index);
---

<BaseLayout>
  <div class="space-y-10">
    <Intro />
    <Projects projects={sortedProjects} />

    <!-- <div class="space-y-2">
      <h3 class="text-2xl font-bold">Too many posts coming soon!</h3>
      <p>
        I've been trying to start writing but I can't find cool ideas but I will
        start writing about some cool stuff soon.
      </p>
    </div> -->

    {
      pinnedPosts.length > 0 && (
        <div class="space-y-4">
          <div class="flex items-end justify-between">
            <h2 class="text-2xl font-bold">Pinned Posts</h2>
            <a
              href="/blog"
              class="text-sm font-medium underline-offset-2 hover:underline"
            >
              View all
            </a>
          </div>
          <Posts posts={pinnedPosts} />
        </div>
      )
    }

    <div class="space-y-4">
      <div class="flex items-end justify-between">
        <h2 class="text-2xl font-bold">Latest Posts</h2>
        {
          sortedPosts.length > 0 && (
            <a
              href="/blog"
              class="text-sm font-medium underline-offset-2 hover:underline"
            >
              View all
            </a>
          )
        }
      </div>
      {
        sortedPosts.length > 0 ? (
          <Posts posts={sortedPosts} />
        ) : (
          <p class="font-semibold">
            Sorry, I lied ğŸ˜… there is no posts yet on this blog but I'm
            currently working ğŸ‘·â€â™‚ï¸ on a tutorial series called "Lambda Calculus
            For All". Stay Tuned ğŸ˜„!
          </p>
        )
      }
    </div>

    {
      pinnedSeries.length > 0 && (
        <div class="space-y-5">
          <div class="flex items-end justify-between">
            <h2 class="text-2xl font-bold">Pinned Series</h2>
            <a
              href="/series"
              class="text-sm font-medium underline-offset-2 hover:underline"
            >
              View all
            </a>
          </div>
          <SeriesList seriesList={pinnedSeries} />
        </div>
      )
    }
  </div>
</BaseLayout>
